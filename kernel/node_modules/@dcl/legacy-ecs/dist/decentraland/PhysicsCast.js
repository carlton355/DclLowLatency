import { Vector3, Matrix } from '@dcl/ecs-math';
import { uuid, log } from '../ecs/helpers';
import { Camera } from './Camera';
/**
 * @internal
 */
var QueryPrefix;
(function (QueryPrefix) {
    QueryPrefix["HitFirst"] = "rqhf";
    QueryPrefix["HitAll"] = "rqha";
})(QueryPrefix || (QueryPrefix = {}));
/**
 * @public
 */
var PhysicsCast = /** @class */ (function () {
    function PhysicsCast() {
        this.queries = {};
    }
    Object.defineProperty(PhysicsCast, "instance", {
        get: function () {
            PhysicsCast.ensureInstance();
            return PhysicsCast._instance;
        },
        enumerable: false,
        configurable: true
    });
    PhysicsCast.ensureInstance = function () {
        if (!PhysicsCast._instance) {
            PhysicsCast._instance = new PhysicsCast();
        }
    };
    PhysicsCast.prototype.getRayFromCamera = function (distance) {
        var rotation = Camera.instance.rotation;
        var rotationMat = Matrix.Identity();
        rotation.toRotationMatrix(rotationMat);
        var direction = Vector3.TransformCoordinates(Vector3.Forward(), rotationMat);
        var ray = {
            origin: Camera.instance.position,
            direction: direction,
            distance: distance
        };
        return ray;
    };
    PhysicsCast.prototype.getRayFromPositions = function (from, to) {
        var direction = to.subtract(from);
        var length = direction.length();
        var ray = {
            origin: from,
            direction: direction.normalize(),
            distance: length
        };
        return ray;
    };
    PhysicsCast.prototype.hitFirst = function (ray, hitCallback, id) {
        var queryId = typeof id === 'number' ? QueryPrefix.HitFirst + id : uuid();
        this.queries[queryId] = hitCallback;
        if (typeof dcl !== 'undefined') {
            dcl.query('raycast', { queryId: queryId, queryType: 'HitFirst', ray: ray });
        }
    };
    PhysicsCast.prototype.hitAll = function (ray, hitCallback, id) {
        var queryId = typeof id === 'number' ? QueryPrefix.HitAll + id : uuid();
        this.queries[queryId] = hitCallback;
        if (typeof dcl !== 'undefined') {
            dcl.query('raycast', { queryId: queryId, queryType: 'HitAll', ray: ray });
        }
    };
    PhysicsCast.prototype.hitFirstAvatar = function (_ray, _hitCallback) {
        log('not implemented yet');
    };
    PhysicsCast.prototype.hitAllAvatars = function (_ray, _hitCallback) {
        log('not implemented yet');
    };
    PhysicsCast.prototype.handleRaycastHitFirstResponse = function (response) {
        this.queries[response.payload.queryId](response.payload.payload);
        delete this.queries[response.payload.queryId];
    };
    PhysicsCast.prototype.handleRaycastHitAllResponse = function (response) {
        this.queries[response.payload.queryId](response.payload.payload);
        delete this.queries[response.payload.queryId];
    };
    return PhysicsCast;
}());
export { PhysicsCast };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUGh5c2ljc0Nhc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvZGVjZW50cmFsYW5kL1BoeXNpY3NDYXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFBO0FBRy9DLE9BQU8sRUFBRSxJQUFJLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUE7QUFFMUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLFVBQVUsQ0FBQTtBQVdqQzs7R0FFRztBQUNILElBQUssV0FHSjtBQUhELFdBQUssV0FBVztJQUNkLGdDQUFpQixDQUFBO0lBQ2pCLDhCQUFlLENBQUE7QUFDakIsQ0FBQyxFQUhJLFdBQVcsS0FBWCxXQUFXLFFBR2Y7QUErRkQ7O0dBRUc7QUFDSDtJQUlFO1FBRlEsWUFBTyxHQUFnRCxFQUFFLENBQUE7SUFFMUMsQ0FBQztJQUV4QixzQkFBa0IsdUJBQVE7YUFBMUI7WUFDRSxXQUFXLENBQUMsY0FBYyxFQUFFLENBQUE7WUFDNUIsT0FBTyxXQUFXLENBQUMsU0FBUyxDQUFBO1FBQzlCLENBQUM7OztPQUFBO0lBRU0sMEJBQWMsR0FBckI7UUFDRSxJQUFJLENBQUMsV0FBVyxDQUFDLFNBQVMsRUFBRTtZQUMxQixXQUFXLENBQUMsU0FBUyxHQUFHLElBQUksV0FBVyxFQUFFLENBQUE7U0FDMUM7SUFDSCxDQUFDO0lBRU0sc0NBQWdCLEdBQXZCLFVBQXdCLFFBQWdCO1FBQ3RDLElBQU0sUUFBUSxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFBO1FBQ3pDLElBQU0sV0FBVyxHQUFXLE1BQU0sQ0FBQyxRQUFRLEVBQUUsQ0FBQTtRQUM3QyxRQUFRLENBQUMsZ0JBQWdCLENBQUMsV0FBVyxDQUFDLENBQUE7UUFDdEMsSUFBTSxTQUFTLEdBQUcsT0FBTyxDQUFDLG9CQUFvQixDQUM1QyxPQUFPLENBQUMsT0FBTyxFQUFFLEVBQ2pC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MywgTWF0cml4IH0gZnJvbSAnQGRjbC9lY3MtbWF0aCdcblxuaW1wb3J0IHsgUmF5Y2FzdFJlc3BvbnNlIH0gZnJvbSAnLi9FdmVudHMnXG5pbXBvcnQgeyB1dWlkLCBsb2cgfSBmcm9tICcuLi9lY3MvaGVscGVycydcblxuaW1wb3J0IHsgQ2FtZXJhIH0gZnJvbSAnLi9DYW1lcmEnXG5cbi8qKlxuICogQHB1YmxpY1xuICovXG5leHBvcnQgdHlwZSBRdWVyeVR5cGUgPVxuICB8ICdIaXRGaXJzdCdcbiAgfCAnSGl0QWxsJ1xuICB8ICdIaXRGaXJzdEF2YXRhcidcbiAgfCAnSGl0QWxsQXZhdGFycydcblxuLyoqXG4gKiBAaW50ZXJuYWxcbiAqL1xuZW51bSBRdWVyeVByZWZpeCB7XG4gIEhpdEZpcnN0ID0gJ3JxaGYnLFxuICBIaXRBbGwgPSAncnFoYSdcbn1cblxuLyoqXG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBSYXljYXN0UXVlcnkge1xuICBxdWVyeUlkOiBzdHJpbmdcbiAgcXVlcnlUeXBlOiBRdWVyeVR5cGVcbiAgcmF5OiBSYXlcbn1cblxuLyoqXG4gKiBAcHVibGljXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgUmF5Y2FzdEhpdCB7XG4gIGRpZEhpdDogYm9vbGVhblxuICByYXk6IFJheVxuICBoaXRQb2ludDogUmVhZE9ubHlWZWN0b3IzXG4gIGhpdE5vcm1hbDogUmVhZE9ubHlWZWN0b3IzXG59XG5cbi8qKlxuICogQHB1YmxpY1xuICovXG5leHBvcnQgaW50ZXJmYWNlIFJheSB7XG4gIG9yaWdpbjogUmVhZE9ubHlWZWN0b3IzXG4gIGRpcmVjdGlvbjogUmVhZE9ubHlWZWN0b3IzXG4gIGRpc3RhbmNlOiBudW1iZXJcbn1cblxuLyoqXG4gKiBAcHVibGljXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgSGl0RW50aXR5SW5mbyB7XG4gIGlzVmFsaWQ6IGJvb2xlYW5cbiAgZW50aXR5SWQ6IHN0cmluZ1xuICBtZXNoTmFtZTogc3RyaW5nXG59XG5cbi8qKlxuICogQHB1YmxpY1xuICovXG5leHBvcnQgaW50ZXJmYWNlIFJheWNhc3RIaXRFbnRpdHkgZXh0ZW5kcyBSYXljYXN0SGl0IHtcbiAgZW50aXR5OiBIaXRFbnRpdHlJbmZvXG59XG5cbi8qKlxuICogQHB1YmxpY1xuICovXG5leHBvcnQgaW50ZXJmYWNlIFJheWNhc3RIaXRFbnRpdGllcyBleHRlbmRzIFJheWNhc3RIaXQge1xuICBlbnRpdGllczogUmF5Y2FzdEhpdEVudGl0eVtdXG59XG5cbi8qKlxuICogQHB1YmxpY1xuICovXG5leHBvcnQgaW50ZXJmYWNlIEJhc2ljQXZhdGFySW5mbyB7XG4gIHVzZXJJZDogc3RyaW5nXG4gIG5hbWU6IHN0cmluZ1xufVxuXG4vKipcbiAqIEBwdWJsaWNcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBSYXljYXN0SGl0QXZhdGFyIGV4dGVuZHMgUmF5Y2FzdEhpdCB7XG4gIGF2YXRhcjogQmFzaWNBdmF0YXJJbmZvXG59XG5cbi8qKlxuICogQHB1YmxpY1xuICovXG5leHBvcnQgaW50ZXJmYWNlIFJheWNhc3RIaXRBdmF0YXJzIGV4dGVuZHMgUmF5Y2FzdEhpdCB7XG4gIGF2YXRhcnM6IEJhc2ljQXZhdGFySW5mb1tdXG59XG5cbi8qKlxuICogQHB1YmxpY1xuICovXG5leHBvcnQgaW50ZXJmYWNlIElQaHlzaWNzQ2FzdCB7XG4gIGhpdEZpcnN0KFxuICAgIHJheTogUmF5LFxuICAgIGhpdENhbGxiYWNrOiAoZXZlbnQ6IFJheWNhc3RIaXRFbnRpdHkpID0+IHZvaWQsXG4gICAgaWQ/OiBudW1iZXJcbiAgKTogdm9pZFxuICBoaXRBbGwoXG4gICAgcmF5OiBSYXksXG4gICAgaGl0Q2FsbGJhY2s6IChldmVudDogUmF5Y2FzdEhpdEVudGl0aWVzKSA9PiB2b2lkLFxuICAgIGlkPzogbnVtYmVyXG4gICk6IHZvaWRcbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBoaXRGaXJzdEF2YXRhcihyYXk6IFJheSwgaGl0Q2FsbGJhY2s6IChldmVudDogUmF5Y2FzdEhpdEF2YXRhcikgPT4gdm9pZCk6IHZvaWRcbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBoaXRBbGxBdmF0YXJzKHJheTogUmF5LCBoaXRDYWxsYmFjazogKGV2ZW50OiBSYXljYXN0SGl0QXZhdGFycykgPT4gdm9pZCk6IHZvaWRcbn1cblxuLyoqXG4gKiBAcHVibGljXG4gKi9cbmV4cG9ydCBjbGFzcyBQaHlzaWNzQ2FzdCBpbXBsZW1lbnRzIElQaHlzaWNzQ2FzdCB7XG4gIHByaXZhdGUgc3RhdGljIF9pbnN0YW5jZTogUGh5c2ljc0Nhc3RcbiAgcHJpdmF0ZSBxdWVyaWVzOiBSZWNvcmQ8c3RyaW5nLCAoZXZlbnQ6IFJheWNhc3RIaXQpID0+IHZvaWQ+ID0ge31cblxuICBwcml2YXRlIGNvbnN0cnVjdG9yKCkge31cblxuICBwdWJsaWMgc3RhdGljIGdldCBpbnN0YW5jZSgpOiBQaHlzaWNzQ2FzdCB7XG4gICAgUGh5c2ljc0Nhc3QuZW5zdXJlSW5zdGFuY2UoKVxuICAgIHJldHVybiBQaHlzaWNzQ2FzdC5faW5zdGFuY2VcbiAgfVxuXG4gIHN0YXRpYyBlbnN1cmVJbnN0YW5jZSgpOiBhbnkge1xuICAgIGlmICghUGh5c2ljc0Nhc3QuX2luc3RhbmNlKSB7XG4gICAgICBQaHlzaWNzQ2FzdC5faW5zdGFuY2UgPSBuZXcgUGh5c2ljc0Nhc3QoKVxuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBnZXRSYXlGcm9tQ2FtZXJhKGRpc3RhbmNlOiBudW1iZXIpIHtcbiAgICBjb25zdCByb3RhdGlvbiA9IENhbWVyYS5pbnN0YW5jZS5yb3RhdGlvblxuICAgIGNvbnN0IHJvdGF0aW9uTWF0OiBNYXRyaXggPSBNYXRyaXguSWRlbnRpdHkoKVxuICAgIHJvdGF0aW9uLnRvUm90YXRpb25NYXRyaXgocm90YXRpb25NYXQpXG4gICAgY29uc3QgZGlyZWN0aW9uID0gVmVjdG9yMy5UcmFuc2Zvcm1Db29yZGluYXRlcyhcbiAgICAgIFZlY3RvcjMuRm9yd2FyZCgpLFxuICAgICAgcm90YXRpb25NYXRcbiAgICApXG5cbiAgICBjb25zdCByYXk6IFJheSA9IHtcbiAgICAgIG9yaWdpbjogQ2FtZXJhLmluc3RhbmNlLnBvc2l0aW9uLFxuICAgICAgZGlyZWN0aW9uOiBkaXJlY3Rpb24sXG4gICAgICBkaXN0YW5jZTogZGlzdGFuY2VcbiAgICB9XG5cbiAgICByZXR1cm4gcmF5XG4gIH1cblxuICBwdWJsaWMgZ2V0UmF5RnJvbVBvc2l0aW9ucyhmcm9tOiBWZWN0b3IzLCB0bzogVmVjdG9yMykge1xuICAgIGNvbnN0IGRpcmVjdGlvbiA9IHRvLnN1YnRyYWN0KGZyb20pXG4gICAgY29uc3QgbGVuZ3RoID0gZGlyZWN0aW9uLmxlbmd0aCgpXG5cbiAgICBjb25zdCByYXk6IFJheSA9IHtcbiAgICAgIG9yaWdpbjogZnJvbSxcbiAgICAgIGRpcmVjdGlvbjogZGlyZWN0aW9uLm5vcm1hbGl6ZSgpLFxuICAgICAgZGlzdGFuY2U6IGxlbmd0aFxuICAgIH1cblxuICAgIHJldHVybiByYXlcbiAgfVxuXG4gIHB1YmxpYyBoaXRGaXJzdChcbiAgICByYXk6IFJheSxcbiAgICBoaXRDYWxsYmFjazogKGV2ZW50OiBSYXljYXN0SGl0RW50aXR5KSA9PiB2b2lkLFxuICAgIGlkPzogbnVtYmVyXG4gICkge1xuICAgIGNvbnN0IHF1ZXJ5SWQgPSB0eXBlb2YgaWQgPT09ICdudW1iZXInID8gUXVlcnlQcmVmaXguSGl0Rmlyc3QgKyBpZCA6IHV1aWQoKVxuXG4gICAgdGhpcy5xdWVyaWVzW3F1ZXJ5SWRdID0gaGl0Q2FsbGJhY2sgYXMgKGV2ZW50OiBSYXljYXN0SGl0KSA9PiB2b2lkXG5cbiAgICBpZiAodHlwZW9mIGRjbCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIGRjbC5xdWVyeSgncmF5Y2FzdCcsIHsgcXVlcnlJZCwgcXVlcnlUeXBlOiAnSGl0Rmlyc3QnLCByYXkgfSlcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgaGl0QWxsKFxuICAgIHJheTogUmF5LFxuICAgIGhpdENhbGxiYWNrOiAoZXZlbnQ6IFJheWNhc3RIaXRFbnRpdGllcykgPT4gdm9pZCxcbiAgICBpZD86IG51bWJlclxuICApIHtcbiAgICBjb25zdCBxdWVyeUlkID0gdHlwZW9mIGlkID09PSAnbnVtYmVyJyA/IFF1ZXJ5UHJlZml4LkhpdEFsbCArIGlkIDogdXVpZCgpXG5cbiAgICB0aGlzLnF1ZXJpZXNbcXVlcnlJZF0gPSBoaXRDYWxsYmFjayBhcyAoZXZlbnQ6IFJheWNhc3RIaXQpID0+IHZvaWRcblxuICAgIGlmICh0eXBlb2YgZGNsICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgZGNsLnF1ZXJ5KCdyYXljYXN0JywgeyBxdWVyeUlkLCBxdWVyeVR5cGU6ICdIaXRBbGwnLCByYXkgfSlcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgaGl0Rmlyc3RBdmF0YXIoXG4gICAgX3JheTogUmF5LFxuICAgIF9oaXRDYWxsYmFjazogKGV2ZW50OiBSYXljYXN0SGl0QXZhdGFyKSA9PiB2b2lkXG4gICkge1xuICAgIGxvZygnbm90IGltcGxlbWVudGVkIHlldCcpXG4gIH1cblxuICBwdWJsaWMgaGl0QWxsQXZhdGFycyhcbiAgICBfcmF5OiBSYXksXG4gICAgX2hpdENhbGxiYWNrOiAoZXZlbnQ6IFJheWNhc3RIaXRBdmF0YXJzKSA9PiB2b2lkXG4gICkge1xuICAgIGxvZygnbm90IGltcGxlbWVudGVkIHlldCcpXG4gIH1cblxuICBwdWJsaWMgaGFuZGxlUmF5Y2FzdEhpdEZpcnN0UmVzcG9uc2UoXG4gICAgcmVzcG9uc2U6IFJheWNhc3RSZXNwb25zZTxSYXljYXN0SGl0RW50aXR5PlxuICApIHtcbiAgICB0aGlzLnF1ZXJpZXNbcmVzcG9uc2UucGF5bG9hZC5xdWVyeUlkXShyZXNwb25zZS5wYXlsb2FkLnBheWxvYWQpXG4gICAgZGVsZXRlIHRoaXMucXVlcmllc1tyZXNwb25zZS5wYXlsb2FkLnF1ZXJ5SWRdXG4gIH1cblxuICBwdWJsaWMgaGFuZGxlUmF5Y2FzdEhpdEFsbFJlc3BvbnNlKFxuICAgIHJlc3BvbnNlOiBSYXljYXN0UmVzcG9uc2U8UmF5Y2FzdEhpdEVudGl0aWVzPlxuICApIHtcbiAgICB0aGlzLnF1ZXJpZXNbcmVzcG9uc2UucGF5bG9hZC5xdWVyeUlkXShyZXNwb25zZS5wYXlsb2FkLnBheWxvYWQpXG4gICAgZGVsZXRlIHRoaXMucXVlcmllc1tyZXNwb25zZS5wYXlsb2FkLnF1ZXJ5SWRdXG4gIH1cbn1cbiJdfQ==
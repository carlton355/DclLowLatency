import { UUIDEvent, PointerEvent, RaycastResponse } from './Events';
import { OnUUIDEvent } from './Components';
import { ComponentAdded, ComponentRemoved } from '../ecs/IEntity';
import { Input } from './Input';
import { PhysicsCast } from './PhysicsCast';
/**
 * @public
 */
var RaycastEventSystem = /** @class */ (function () {
    function RaycastEventSystem() {
    }
    RaycastEventSystem.prototype.activate = function (engine) {
        engine.eventManager.addListener(RaycastResponse, this, function (event) {
            if (event.payload.queryType === 'HitFirst') {
                PhysicsCast.instance.handleRaycastHitFirstResponse(event);
            }
            else if (event.payload.queryType === 'HitAll') {
                PhysicsCast.instance.handleRaycastHitAllResponse(event);
            }
        });
        if (typeof dcl !== 'undefined') {
            dcl.subscribe('raycastResponse');
        }
    };
    RaycastEventSystem.prototype.deactivate = function () {
        if (typeof dcl !== 'undefined') {
            dcl.unsubscribe('raycastResponse');
        }
    };
    return RaycastEventSystem;
}());
export { RaycastEventSystem };
/**
 * @public
 */
var PointerEventSystem = /** @class */ (function () {
    function PointerEventSystem() {
    }
    PointerEventSystem.prototype.activate = function (engine) {
        engine.eventManager.addListener(PointerEvent, this, function (event) {
            Input.instance.handlePointerEvent(event.payload);
        });
        if (typeof dcl !== 'undefined') {
            dcl.subscribe('pointerUp');
            dcl.subscribe('pointerDown');
            dcl.subscribe('actionButtonEvent');
        }
    };
    PointerEventSystem.prototype.deactivate = function () {
        if (typeof dcl !== 'undefined') {
            dcl.unsubscribe('pointerUp');
            dcl.unsubscribe('pointerDown');
            dcl.unsubscribe('actionButtonEvent');
        }
    };
    return PointerEventSystem;
}());
export { PointerEventSystem };
/**
 * @public
 */
var UUIDEventSystem = /** @class */ (function () {
    function UUIDEventSystem() {
        this.handlerMap = {};
    }
    UUIDEventSystem.prototype.activate = function (engine) {
        engine.eventManager.addListener(UUIDEvent, this, this.handleEvent);
        engine.eventManager.addListener(ComponentAdded, this, this.componentAdded);
        engine.eventManager.addListener(ComponentRemoved, this, this.componentRemoved);
        if (typeof dcl !== 'undefined') {
            dcl.subscribe('uuidEvent');
        }
    };
    UUIDEventSystem.prototype.deactivate = function () {
        if (typeof dcl !== 'undefined') {
            dcl.unsubscribe('uuidEvent');
        }
    };
    UUIDEventSystem.prototype.onAddEntity = function (entity) {
        for (var componentName in entity.components) {
            var component = entity.components[componentName];
            if (component instanceof OnUUIDEvent) {
                this.handlerMap[component.uuid] = component;
            }
        }
    };
    UUIDEventSystem.prototype.onRemoveEntity = function (entity) {
        for (var componentName in entity.components) {
            var component = entity.components[componentName];
            if (component instanceof OnUUIDEvent) {
                delete this.handlerMap[component.uuid];
            }
        }
    };
    UUIDEventSystem.prototype.componentAdded = function (event) {
        if (event.entity.isAddedToEngine()) {
            var component = event.entity.components[event.componentName];
            if (component instanceof OnUUIDEvent) {
                this.handlerMap[component.uuid] = component;
            }
        }
    };
    UUIDEventSystem.prototype.componentRemoved = function (event) {
        if (event.entity.isAddedToEngine()) {
            if (event.component instanceof OnUUIDEvent) {
                delete this.handlerMap[event.component.uuid];
            }
        }
    };
    UUIDEventSystem.prototype.handleEvent = function (event) {
        if (event.uuid in this.handlerMap) {
            var handler = this.handlerMap[event.uuid];
            if (handler) {
                if (handler.callback && 'call' in handler.callback) {
                    handler.callback(event.payload);
                }
            }
        }
    };
    return UUIDEventSystem;
}());
export { UUIDEventSystem };
/** @internal */
export var raycastEventSystem = new RaycastEventSystem();
/** @internal */
export var pointerEventSystem = new PointerEventSystem();
/** @internal */
export var uuidEventSystem = new UUIDEventSystem();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU3lzdGVtcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9kZWNlbnRyYWxhbmQvU3lzdGVtcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxlQUFlLEVBQUUsTUFBTSxVQUFVLENBQUE7QUFDbkUsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGNBQWMsQ0FBQTtBQUMxQyxPQUFPLEVBRUwsY0FBYyxFQUNkLGdCQUFnQixFQUVqQixNQUFNLGdCQUFnQixDQUFBO0FBQ3ZCLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxTQUFTLENBQUE7QUFDL0IsT0FBTyxFQUNMLFdBQVcsRUFHWixNQUFNLGVBQWUsQ0FBQTtBQUV0Qjs7R0FFRztBQUNIO0lBQUE7SUF3QkEsQ0FBQztJQXZCQyxxQ0FBUSxHQUFSLFVBQVMsTUFBYztRQUNyQixNQUFNLENBQUMsWUFBWSxDQUFDLFdBQVcsQ0FBQyxlQUFlLEVBQUUsSUFBSSxFQUFFLFVBQUMsS0FBSztZQUMzRCxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsU0FBUyxLQUFLLFVBQVUsRUFBRTtnQkFDMUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyw2QkFBNkIsQ0FDaEQsS0FBMEMsQ0FDM0MsQ0FBQTthQUNGO2lCQUFNLElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxTQUFTLEtBQUssUUFBUSxFQUFFO2dCQUMvQyxXQUFXLENBQUMsUUFBUSxDQUFDLDJCQUEyQixDQUM5QyxLQUE0QyxDQUM3QyxDQUFBO2FBQ0Y7UUFDSCxDQUFDLENBQUMsQ0FBQTtRQUVGLElBQUksT0FBTyxHQUFHLEtBQUssV0FBVyxFQUFFO1lBQzlCLEdBQUcsQ0FBQyxTQUFTLENBQUMsaUJBQWlCLENBQUMsQ0FBQTtTQUNqQztJQUNILENBQUM7SUFFRCx1Q0FBVSxHQUFWO1FBQ0UsSUFBSSxPQUFPLEdBQUcsS0FBSyxXQUFXLEVBQUU7WUFDOUIsR0FBRyxDQUFDLFdBQVcsQ0FB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LENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFbmdpbmUgfSBmcm9tICcuLi9lY3MvRW5naW5lJ1xuaW1wb3J0IHsgVVVJREV2ZW50LCBQb2ludGVyRXZlbnQsIFJheWNhc3RSZXNwb25zZSB9IGZyb20gJy4vRXZlbnRzJ1xuaW1wb3J0IHsgT25VVUlERXZlbnQgfSBmcm9tICcuL0NvbXBvbmVudHMnXG5pbXBvcnQge1xuICBJU3lzdGVtLFxuICBDb21wb25lbnRBZGRlZCxcbiAgQ29tcG9uZW50UmVtb3ZlZCxcbiAgSUVudGl0eVxufSBmcm9tICcuLi9lY3MvSUVudGl0eSdcbmltcG9ydCB7IElucHV0IH0gZnJvbSAnLi9JbnB1dCdcbmltcG9ydCB7XG4gIFBoeXNpY3NDYXN0LFxuICBSYXljYXN0SGl0RW50aXR5LFxuICBSYXljYXN0SGl0RW50aXRpZXNcbn0gZnJvbSAnLi9QaHlzaWNzQ2FzdCdcblxuLyoqXG4gKiBAcHVibGljXG4gKi9cbmV4cG9ydCBjbGFzcyBSYXljYXN0RXZlbnRTeXN0ZW0gaW1wbGVtZW50cyBJU3lzdGVtIHtcbiAgYWN0aXZhdGUoZW5naW5lOiBFbmdpbmUpIHtcbiAgICBlbmdpbmUuZXZlbnRNYW5hZ2VyLmFkZExpc3RlbmVyKFJheWNhc3RSZXNwb25zZSwgdGhpcywgKGV2ZW50KSA9PiB7XG4gICAgICBpZiAoZXZlbnQucGF5bG9hZC5xdWVyeVR5cGUgPT09ICdIaXRGaXJzdCcpIHtcbiAgICAgICAgUGh5c2ljc0Nhc3QuaW5zdGFuY2UuaGFuZGxlUmF5Y2FzdEhpdEZpcnN0UmVzcG9uc2UoXG4gICAgICAgICAgZXZlbnQgYXMgUmF5Y2FzdFJlc3BvbnNlPFJheWNhc3RIaXRFbnRpdHk+XG4gICAgICAgIClcbiAgICAgIH0gZWxzZSBpZiAoZXZlbnQucGF5bG9hZC5xdWVyeVR5cGUgPT09ICdIaXRBbGwnKSB7XG4gICAgICAgIFBoeXNpY3NDYXN0Lmluc3RhbmNlLmhhbmRsZVJheWNhc3RIaXRBbGxSZXNwb25zZShcbiAgICAgICAgICBldmVudCBhcyBSYXljYXN0UmVzcG9uc2U8UmF5Y2FzdEhpdEVudGl0aWVzPlxuICAgICAgICApXG4gICAgICB9XG4gICAgfSlcblxuICAgIGlmICh0eXBlb2YgZGNsICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgZGNsLnN1YnNjcmliZSgncmF5Y2FzdFJlc3BvbnNlJylcbiAgICB9XG4gIH1cblxuICBkZWFjdGl2YXRlKCkge1xuICAgIGlmICh0eXBlb2YgZGNsICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgZGNsLnVuc3Vic2NyaWJlKCdyYXljYXN0UmVzcG9uc2UnKVxuICAgIH1cbiAgfVxufVxuXG4vKipcbiAqIEBwdWJsaWNcbiAqL1xuZXhwb3J0IGNsYXNzIFBvaW50ZXJFdmVudFN5c3RlbSBpbXBsZW1lbnRzIElTeXN0ZW0ge1xuICBhY3RpdmF0ZShlbmdpbmU6IEVuZ2luZSkge1xuICAgIGVuZ2luZS5ldmVudE1hbmFnZXIuYWRkTGlzdGVuZXIoUG9pbnRlckV2ZW50LCB0aGlzLCAoZXZlbnQpID0+IHtcbiAgICAgIElucHV0Lmluc3RhbmNlLmhhbmRsZVBvaW50ZXJFdmVudChldmVudC5wYXlsb2FkIGFzIEdsb2JhbElucHV0RXZlbnRSZXN1bHQpXG4gICAgfSlcblxuICAgIGlmICh0eXBlb2YgZGNsICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgZGNsLnN1YnNjcmliZSgncG9pbnRlclVwJylcbiAgICAgIGRjbC5zdWJzY3JpYmUoJ3BvaW50ZXJEb3duJylcbiAgICAgIGRjbC5zdWJzY3JpYmUoJ2FjdGlvbkJ1dHRvbkV2ZW50JylcbiAgICB9XG4gIH1cblxuICBkZWFjdGl2YXRlKCkge1xuICAgIGlmICh0eXBlb2YgZGNsICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgZGNsLnVuc3Vic2NyaWJlKCdwb2ludGVyVXAnKVxuICAgICAgZGNsLnVuc3Vic2NyaWJlKCdwb2ludGVyRG93bicpXG4gICAgICBkY2wudW5zdWJzY3JpYmUoJ2FjdGlvbkJ1dHRvbkV2ZW50JylcbiAgICB9XG4gIH1cbn1cblxuLyoqXG4gKiBAcHVibGljXG4gKi9cbmV4cG9ydCBjbGFzcyBVVUlERXZlbnRTeXN0ZW0gaW1wbGVtZW50cyBJU3lzdGVtIHtcbiAgaGFuZGxlck1hcDogeyBbdXVpZDogc3RyaW5nXTogT25VVUlERXZlbnQ8YW55PiB9ID0ge31cblxuICBhY3RpdmF0ZShlbmdpbmU6IEVuZ2luZSkge1xuICAgIGVuZ2luZS5ldmVudE1hbmFnZXIuYWRkTGlzdGVuZXIoVVVJREV2ZW50LCB0aGlzLCB0aGlzLmhhbmRsZUV2ZW50KVxuICAgIGVuZ2luZS5ldmVudE1hbmFnZXIuYWRkTGlzdGVuZXIoQ29tcG9uZW50QWRkZWQsIHRoaXMsIHRoaXMuY29tcG9uZW50QWRkZWQpXG4gICAgZW5naW5lLmV2ZW50TWFuYWdlci5hZGRMaXN0ZW5lcihcbiAgICAgIENvbXBvbmVudFJlbW92ZWQsXG4gICAgICB0aGlzLFxuICAgICAgdGhpcy5jb21wb25lbnRSZW1vdmVkXG4gICAgKVxuXG4gICAgaWYgKHR5cGVvZiBkY2wgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICBkY2wuc3Vic2NyaWJlKCd1dWlkRXZlbnQnKVxuICAgIH1cbiAgfVxuXG4gIGRlYWN0aXZhdGUoKSB7XG4gICAgaWYgKHR5cGVvZiBkY2wgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICBkY2wudW5zdWJzY3JpYmUoJ3V1aWRFdmVudCcpXG4gICAgfVxuICB9XG5cbiAgb25BZGRFbnRpdHkoZW50aXR5OiBJRW50aXR5KSB7XG4gICAgZm9yIChjb25zdCBjb21wb25lbnROYW1lIGluIGVudGl0eS5jb21wb25lbnRzKSB7XG4gICAgICBjb25zdCBjb21wb25lbnQgPSBlbnRpdHkuY29tcG9uZW50c1tjb21wb25lbnROYW1lXVxuXG4gICAgICBpZiAoY29tcG9uZW50IGluc3RhbmNlb2YgT25VVUlERXZlbnQpIHtcbiAgICAgICAgdGhpcy5oYW5kbGVyTWFwW2NvbXBvbmVudC51dWlkXSA9IGNvbXBvbmVudFxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIG9uUmVtb3ZlRW50aXR5KGVudGl0eTogSUVudGl0eSkge1xuICAgIGZvciAoY29uc3QgY29tcG9uZW50TmFtZSBpbiBlbnRpdHkuY29tcG9uZW50cykge1xuICAgICAgY29uc3QgY29tcG9uZW50ID0gZW50aXR5LmNvbXBvbmVudHNbY29tcG9uZW50TmFtZV1cblxuICAgICAgaWYgKGNvbXBvbmVudCBpbnN0YW5jZW9mIE9uVVVJREV2ZW50KSB7XG4gICAgICAgIGRlbGV0ZSB0aGlzLmhhbmRsZXJNYXBbY29tcG9uZW50LnV1aWRdXG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjb21wb25lbnRBZGRlZChldmVudDogQ29tcG9uZW50QWRkZWQpIHtcbiAgICBpZiAoZXZlbnQuZW50aXR5LmlzQWRkZWRUb0VuZ2luZSgpKSB7XG4gICAgICBjb25zdCBjb21wb25lbnQgPSBldmVudC5lbnRpdHkuY29tcG9uZW50c1tldmVudC5jb21wb25lbnROYW1lXVxuXG4gICAgICBpZiAoY29tcG9uZW50IGluc3RhbmNlb2YgT25VVUlERXZlbnQpIHtcbiAgICAgICAgdGhpcy5oYW5kbGVyTWFwW2NvbXBvbmVudC51dWlkXSA9IGNvbXBvbmVudFxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY29tcG9uZW50UmVtb3ZlZChldmVudDogQ29tcG9uZW50UmVtb3ZlZCkge1xuICAgIGlmIChldmVudC5lbnRpdHkuaXNBZGRlZFRvRW5naW5lKCkpIHtcbiAgICAgIGlmIChldmVudC5jb21wb25lbnQgaW5zdGFuY2VvZiBPblVVSURFdmVudCkge1xuICAgICAgICBkZWxldGUgdGhpcy5oYW5kbGVyTWFwW2V2ZW50LmNvbXBvbmVudC51dWlkXVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgaGFuZGxlRXZlbnQoZXZlbnQ6IFVVSURFdmVudCk6IHZvaWQge1xuICAgIGlmIChldmVudC51dWlkIGluIHRoaXMuaGFuZGxlck1hcCkge1xuICAgICAgY29uc3QgaGFuZGxlciA9IHRoaXMuaGFuZGxlck1hcFtldmVudC51dWlkXVxuICAgICAgaWYgKGhhbmRsZXIpIHtcbiAgICAgICAgaWYgKGhhbmRsZXIuY2FsbGJhY2sgJiYgJ2NhbGwnIGluIGhhbmRsZXIuY2FsbGJhY2spIHtcbiAgICAgICAgICBoYW5kbGVyLmNhbGxiYWNrKGV2ZW50LnBheWxvYWQpXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cblxuLyoqIEBpbnRlcm5hbCAqL1xuZXhwb3J0IGNvbnN0IHJheWNhc3RFdmVudFN5c3RlbSA9IG5ldyBSYXljYXN0RXZlbnRTeXN0ZW0oKVxuXG4vKiogQGludGVybmFsICovXG5leHBvcnQgY29uc3QgcG9pbnRlckV2ZW50U3lzdGVtID0gbmV3IFBvaW50ZXJFdmVudFN5c3RlbSgpXG5cbi8qKiBAaW50ZXJuYWwgKi9cbmV4cG9ydCBjb25zdCB1dWlkRXZlbnRTeXN0ZW0gPSBuZXcgVVVJREV2ZW50U3lzdGVtKClcbiJdfQ==
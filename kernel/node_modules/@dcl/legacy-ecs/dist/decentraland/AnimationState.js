var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
import { ObservableComponent } from '../ecs/Component';
import { newId } from '../ecs/helpers';
var defaultParams = {
    looping: true,
    speed: 1.0,
    weight: 1.0,
    layer: 0
};
/**
 * @public
 */
var AnimationState = /** @class */ (function (_super) {
    __extends(AnimationState, _super);
    function AnimationState(clip, params) {
        if (params === void 0) { params = defaultParams; }
        var _this = _super.call(this) || this;
        // @internal
        _this.isAnimationClip = true;
        /**
         * Does the animation loop?, default: true
         */
        _this.looping = defaultParams.looping;
        /**
         * Weight of the animation, values from 0 to 1, used to blend several animations. default: 1
         */
        _this.weight = defaultParams.weight;
        /**
         * Is the animation playing? default: true
         */
        _this.playing = false;
        /**
         * Does any anyone asked to reset the animation? default: false
         */
        _this.shouldReset = false;
        /**
         * The animation speed
         */
        _this.speed = defaultParams.speed;
        // @internal
        _this.name = newId('AnimClip');
        /**
         * Layering allows you to have two or more levels of animation on an object's parameters at the same time
         */
        _this.layer = defaultParams.layer;
        _this.clip = clip;
        _this.setParams(__assign({}, params));
        return _this;
    }
    /**
     * Sets the clip parameters
     */
    AnimationState.prototype.setParams = function (params) {
        this.looping = params.looping !== undefined ? params.looping : this.looping;
        this.speed = params.speed || this.speed;
        this.weight = params.weight || this.weight;
        this.layer = params.layer || this.layer;
        return this;
    };
    AnimationState.prototype.toJSON = function () {
        var ret = JSON.parse(JSON.stringify(_super.prototype.toJSON.call(this)));
        if (this.shouldReset) {
            this.shouldReset = false;
        }
        return ret;
    };
    /**
     * Starts the animation
     */
    AnimationState.prototype.play = function (reset) {
        var _a;
        if (reset === void 0) { reset = false; }
        (_a = this.owner) === null || _a === void 0 ? void 0 : _a.play(this, reset);
    };
    /**
     * Pauses the animation
     */
    AnimationState.prototype.pause = function () {
        var _a;
        (_a = this.owner) === null || _a === void 0 ? void 0 : _a.pause(this);
    };
    /**
     * Resets the animation state to the frame 0
     */
    AnimationState.prototype.reset = function () {
        this.shouldReset = true;
    };
    /**
     * Resets and pauses the animation
     */
    AnimationState.prototype.stop = function () {
        var _a;
        (_a = this.owner) === null || _a === void 0 ? void 0 : _a.stop(this);
    };
    __decorate([
        ObservableComponent.readonly,
        __metadata("design:type", String)
    ], AnimationState.prototype, "clip", void 0);
    __decorate([
        ObservableComponent.field,
        __metadata("design:type", Boolean)
    ], AnimationState.prototype, "looping", void 0);
    __decorate([
        ObservableComponent.field,
        __metadata("design:type", Number)
    ], AnimationState.prototype, "weight", void 0);
    __decorate([
        ObservableComponent.field,
        __metadata("design:type", Boolean)
    ], AnimationState.prototype, "playing", void 0);
    __decorate([
        ObservableComponent.field,
        __metadata("design:type", Boolean)
    ], AnimationState.prototype, "shouldReset", void 0);
    __decorate([
        ObservableComponent.field,
        __metadata("design:type", Number)
    ], AnimationState.prototype, "speed", void 0);
    __decorate([
        ObservableComponent.readonly,
        __metadata("design:type", String)
    ], AnimationState.prototype, "name", void 0);
    return AnimationState;
}(ObservableComponent));
export { AnimationState };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQW5pbWF0aW9uU3RhdGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvZGVjZW50cmFsYW5kL0FuaW1hdGlvblN0YXRlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sa0JBQWtCLENBQUE7QUFDdEQsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLGdCQUFnQixDQUFBO0FBV3RDLElBQU0sYUFBYSxHQUVmO0lBQ0YsT0FBTyxFQUFFLElBQUk7SUFDYixLQUFLLEVBQUUsR0FBRztJQUNWLE1BQU0sRUFBRSxHQUFHO0lBQ1gsS0FBSyxFQUFFLENBQUM7Q0FDVCxDQUFBO0FBRUQ7O0dBRUc7QUFDSDtJQUFvQyxrQ0FBbUI7SUFvRHJELHdCQUFZLElBQVksRUFBRSxNQUF1QztRQUF2Qyx1QkFBQSxFQUFBLHNCQUF1QztRQUFqRSxZQUNFLGlCQUFPLFNBR1I7UUF2REQsWUFBWTtRQUNMLHFCQUFlLEdBQVksSUFBSSxDQUFBO1FBUXRDOztXQUVHO1FBRUksYUFBTyxHQUFZLGFBQWEsQ0FBQyxPQUFPLENBQUE7UUFFL0M7O1dBRUc7UUFFSSxZQUFNLEdBQVcsYUFBYSxDQUFDLE1BQU0sQ0FBQTtRQUU1Qzs7V0FFRztRQUVJLGFBQU8sR0FBWSxLQUFLLENBQUE7UUFFL0I7O1dBRUc7UUFFSSxpQkFBVyxHQUFZLEtBQUssQ0FBQTtRQUVuQzs7V0FFRztRQUVJLFdBQUssR0FBVyxhQUFhLENBQUMsS0FBSyxDQUFBO1FBRTFDLFlBQVk7UUFFSCxVQUFJLEdBQVcsS0FBSyxDQUFDLFVBQVUsQ0FBQyxDQUFBO1FBRXpDOztXQUVHO1FBQ0ksV0FBSyxHQUFXLGFBQWEsQ0FBQyxLQUFLLENBQUE7UUFPeEMsS0FBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUE7UUFDaEIsS0FBSSxDQUFDLFNBQVMsY0FBTSxNQUFNLEVBQUcsQ0FBQTs7SUFDL0IsQ0FBQztJQUVEOztPQUVHO0lBQ0gsa0NBQVMsR0FBVCxVQUFVLE1BQXVCO1FBQy9CLElBQUksQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFDLE9BQU8sS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUE7UUFDM0UsSUFBSSxDQUFDLEtBQUssR0FBRyxNQUFNLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUE7UUFDdkMsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUMsTUFBTSxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUE7UUFDMUMsSUFBSSxDQUFDLEtBQUssR0FBRyxNQUFNLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUE7UUFDdkMsT0FBTyxJQUFJLENBQUE7SUFDYixDQUFDO0lBRUQsK0JBQU0sR0FBTjtRQUNFLElBQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxpQkFBTSxNQUFNLFdBQUUsQ0FBQyxDQUFDLENBQUE7UUFDdEQsSUFBSSxJQUFJLENBQUMsV0FBVyxFQUFFO1lBQ3BCLElBQUksQ0FBQyxXQUFXLEdBQUcsS0FBSyxDQUFBO1NBQ3pCO1FBQ0QsT0FBTyxHQUFHLENBQUE7SUFDWixDQUFDO0lBRUQ7O09BRUc7SUFDSCw2QkFBSSxHQUFKLFVBQUssS0FBc0I7O1FBQXRCLHNCQUFBLEVBQUEsYUFBc0I7UUFDekIsTUFBQSxJQUFJLENBQUMsS0FBSywwQ0FBRSxJQUFJLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFBO0lBQy9CLENBQUM7SUFFRDs7T0FFRztJQUNILDhCQUFLLEdBQUw7O1FBQ0UsTUFBQSxJQUFJLENBQUMsS0FBSywwQ0FBRSxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUE7SUFDekIsQ0FBQztJQUVEOztPQUVHO0lBQ0gsOEJBQUssR0FBTDtRQUNFLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFBO0lBQ3pCLENBQUM7SUFFRDs7T0FFRztJQUNILDZCQUFJLEdBQUo7O1FBQ0UsTUFBQSxJQUFJLENBQUMsS0FBSywwQ0FBRSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUE7SUFDeEIsQ0FBQztJQS9GRDtRQURDLG1CQUFtQixDQUFDLFFBQVE7O2dEQUNEO0lBTTVCO1FBREMsbUJBQW1CLENBQUMsS0FBSzs7bURBQ3FCO0lBTS9DO1FBREMsbUJBQW1CLENBQUMsS0FBSzs7a0RBQ2tCO0lBTTVDO1FBREMsbUJBQW1CLENBQUMsS0FBSzs7bURBQ0s7SUFNL0I7UUFEQyxtQkFBbUIsQ0FBQyxLQUFLOzt1REFDUztJQU1uQztRQURDLG1CQUFtQixDQUFDLEtBQUs7O2lEQUNnQjtJQUkxQztRQURDLG1CQUFtQixDQUFDLFFBQVE7O2dEQUNZO0lBOEQzQyxxQkFBQztDQUFBLEFBeEdELENBQW9DLG1CQUFtQixHQXdHdEQ7U0F4R1ksY0FBYyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE9ic2VydmFibGVDb21wb25lbnQgfSBmcm9tICcuLi9lY3MvQ29tcG9uZW50J1xuaW1wb3J0IHsgbmV3SWQgfSBmcm9tICcuLi9lY3MvaGVscGVycydcbmltcG9ydCB7IEFuaW1hdG9yIH0gZnJvbSAnLi9Db21wb25lbnRzJ1xuXG4vKiogQHB1YmxpYyAqL1xuZXhwb3J0IHR5cGUgQW5pbWF0aW9uUGFyYW1zID0ge1xuICBsb29waW5nPzogYm9vbGVhblxuICBzcGVlZD86IG51bWJlclxuICB3ZWlnaHQ/OiBudW1iZXJcbiAgbGF5ZXI/OiBudW1iZXJcbn1cblxuY29uc3QgZGVmYXVsdFBhcmFtczogUmVxdWlyZWQ8XG4gIFBpY2s8QW5pbWF0aW9uUGFyYW1zLCAnbG9vcGluZycgfCAnc3BlZWQnIHwgJ3dlaWdodCcgfCAnbGF5ZXInPlxuPiA9IHtcbiAgbG9vcGluZzogdHJ1ZSxcbiAgc3BlZWQ6IDEuMCxcbiAgd2VpZ2h0OiAxLjAsXG4gIGxheWVyOiAwXG59XG5cbi8qKlxuICogQHB1YmxpY1xuICovXG5leHBvcnQgY2xhc3MgQW5pbWF0aW9uU3RhdGUgZXh0ZW5kcyBPYnNlcnZhYmxlQ29tcG9uZW50IHtcbiAgLy8gQGludGVybmFsXG4gIHB1YmxpYyBpc0FuaW1hdGlvbkNsaXA6IGJvb2xlYW4gPSB0cnVlXG5cbiAgLyoqXG4gICAqIE5hbWUgb2YgdGhlIGFuaW1hdGlvbiBpbiB0aGUgbW9kZWxcbiAgICovXG4gIEBPYnNlcnZhYmxlQ29tcG9uZW50LnJlYWRvbmx5XG4gIHB1YmxpYyByZWFkb25seSBjbGlwOiBzdHJpbmdcblxuICAvKipcbiAgICogRG9lcyB0aGUgYW5pbWF0aW9uIGxvb3A/LCBkZWZhdWx0OiB0cnVlXG4gICAqL1xuICBAT2JzZXJ2YWJsZUNvbXBvbmVudC5maWVsZFxuICBwdWJsaWMgbG9vcGluZzogYm9vbGVhbiA9IGRlZmF1bHRQYXJhbXMubG9vcGluZ1xuXG4gIC8qKlxuICAgKiBXZWlnaHQgb2YgdGhlIGFuaW1hdGlvbiwgdmFsdWVzIGZyb20gMCB0byAxLCB1c2VkIHRvIGJsZW5kIHNldmVyYWwgYW5pbWF0aW9ucy4gZGVmYXVsdDogMVxuICAgKi9cbiAgQE9ic2VydmFibGVDb21wb25lbnQuZmllbGRcbiAgcHVibGljIHdlaWdodDogbnVtYmVyID0gZGVmYXVsdFBhcmFtcy53ZWlnaHRcblxuICAvKipcbiAgICogSXMgdGhlIGFuaW1hdGlvbiBwbGF5aW5nPyBkZWZhdWx0OiB0cnVlXG4gICAqL1xuICBAT2JzZXJ2YWJsZUNvbXBvbmVudC5maWVsZFxuICBwdWJsaWMgcGxheWluZzogYm9vbGVhbiA9IGZhbHNlXG5cbiAgLyoqXG4gICAqIERvZXMgYW55IGFueW9uZSBhc2tlZCB0byByZXNldCB0aGUgYW5pbWF0aW9uPyBkZWZhdWx0OiBmYWxzZVxuICAgKi9cbiAgQE9ic2VydmFibGVDb21wb25lbnQuZmllbGRcbiAgcHVibGljIHNob3VsZFJlc2V0OiBib29sZWFuID0gZmFsc2VcblxuICAvKipcbiAgICogVGhlIGFuaW1hdGlvbiBzcGVlZFxuICAgKi9cbiAgQE9ic2VydmFibGVDb21wb25lbnQuZmllbGRcbiAgcHVibGljIHNwZWVkOiBudW1iZXIgPSBkZWZhdWx0UGFyYW1zLnNwZWVkXG5cbiAgLy8gQGludGVybmFsXG4gIEBPYnNlcnZhYmxlQ29tcG9uZW50LnJlYWRvbmx5XG4gIHJlYWRvbmx5IG5hbWU6IHN0cmluZyA9IG5ld0lkKCdBbmltQ2xpcCcpXG5cbiAgLyoqXG4gICAqIExheWVyaW5nIGFsbG93cyB5b3UgdG8gaGF2ZSB0d28gb3IgbW9yZSBsZXZlbHMgb2YgYW5pbWF0aW9uIG9uIGFuIG9iamVjdCdzIHBhcmFtZXRlcnMgYXQgdGhlIHNhbWUgdGltZVxuICAgKi9cbiAgcHVibGljIGxheWVyOiBudW1iZXIgPSBkZWZhdWx0UGFyYW1zLmxheWVyXG5cbiAgLy8gQGludGVybmFsXG4gIHB1YmxpYyBvd25lcj86IEFuaW1hdG9yXG5cbiAgY29uc3RydWN0b3IoY2xpcDogc3RyaW5nLCBwYXJhbXM6IEFuaW1hdGlvblBhcmFtcyA9IGRlZmF1bHRQYXJhbXMpIHtcbiAgICBzdXBlcigpXG4gICAgdGhpcy5jbGlwID0gY2xpcFxuICAgIHRoaXMuc2V0UGFyYW1zKHsgLi4ucGFyYW1zIH0pXG4gIH1cblxuICAvKipcbiAgICogU2V0cyB0aGUgY2xpcCBwYXJhbWV0ZXJzXG4gICAqL1xuICBzZXRQYXJhbXMocGFyYW1zOiBBbmltYXRpb25QYXJhbXMpIHtcbiAgICB0aGlzLmxvb3BpbmcgPSBwYXJhbXMubG9vcGluZyAhPT0gdW5kZWZpbmVkID8gcGFyYW1zLmxvb3BpbmcgOiB0aGlzLmxvb3BpbmdcbiAgICB0aGlzLnNwZWVkID0gcGFyYW1zLnNwZWVkIHx8IHRoaXMuc3BlZWRcbiAgICB0aGlzLndlaWdodCA9IHBhcmFtcy53ZWlnaHQgfHwgdGhpcy53ZWlnaHRcbiAgICB0aGlzLmxheWVyID0gcGFyYW1zLmxheWVyIHx8IHRoaXMubGF5ZXJcbiAgICByZXR1cm4gdGhpc1xuICB9XG5cbiAgdG9KU09OKCkge1xuICAgIGNvbnN0IHJldCA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoc3VwZXIudG9KU09OKCkpKVxuICAgIGlmICh0aGlzLnNob3VsZFJlc2V0KSB7XG4gICAgICB0aGlzLnNob3VsZFJlc2V0ID0gZmFsc2VcbiAgICB9XG4gICAgcmV0dXJuIHJldFxuICB9XG5cbiAgLyoqXG4gICAqIFN0YXJ0cyB0aGUgYW5pbWF0aW9uXG4gICAqL1xuICBwbGF5KHJlc2V0OiBib29sZWFuID0gZmFsc2UpIHtcbiAgICB0aGlzLm93bmVyPy5wbGF5KHRoaXMsIHJlc2V0KVxuICB9XG5cbiAgLyoqXG4gICAqIFBhdXNlcyB0aGUgYW5pbWF0aW9uXG4gICAqL1xuICBwYXVzZSgpIHtcbiAgICB0aGlzLm93bmVyPy5wYXVzZSh0aGlzKVxuICB9XG5cbiAgLyoqXG4gICAqIFJlc2V0cyB0aGUgYW5pbWF0aW9uIHN0YXRlIHRvIHRoZSBmcmFtZSAwXG4gICAqL1xuICByZXNldCgpIHtcbiAgICB0aGlzLnNob3VsZFJlc2V0ID0gdHJ1ZVxuICB9XG5cbiAgLyoqXG4gICAqIFJlc2V0cyBhbmQgcGF1c2VzIHRoZSBhbmltYXRpb25cbiAgICovXG4gIHN0b3AoKSB7XG4gICAgdGhpcy5vd25lcj8uc3RvcCh0aGlzKVxuICB9XG59XG4iXX0=
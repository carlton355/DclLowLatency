"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.startSceneRuntime = void 0;
const client_1 = require("./client");
const Utils_1 = require("./Utils");
const sandbox_1 = require("./sandbox");
const permissions_gen_1 = require("@dcl/protocol/out-ts/decentraland/kernel/apis/permissions.gen");
const DecentralandInterface_1 = require("./runtime/DecentralandInterface");
const SetupFpsThrottling_1 = require("./runtime/SetupFpsThrottling");
const DevToolsAdapter_1 = require("./runtime/DevToolsAdapter");
const Events_1 = require("./runtime/Events");
/**
 * Converts a string position "-1,5" => { x: -1, y: 5 }
 */
function parseParcelPosition(position) {
    const [x, y] = position
        .trim()
        .split(/\s*,\s*/)
        .map(($) => parseInt($, 10));
    return { x, y };
}
async function startSceneRuntime(client) {
    const workerName = self.name;
    const clientPort = await client.createPort(`scene-${workerName}`);
    const [EngineApi, EnvironmentApi, Permissions, DevTools] = await Promise.all([
        client_1.LoadableApis.EngineApi(clientPort),
        client_1.LoadableApis.EnvironmentApi(clientPort),
        client_1.LoadableApis.Permissions(clientPort),
        client_1.LoadableApis.DevTools(clientPort),
    ]);
    const [canUseWebsocket, canUseFetch] = (await Permissions.hasManyPermissions({
        permissions: [permissions_gen_1.PermissionItem.PI_USE_WEBSOCKET, permissions_gen_1.PermissionItem.PI_USE_FETCH],
    })).hasManyPermission;
    const devToolsAdapter = new DevToolsAdapter_1.DevToolsAdapter(DevTools);
    const eventState = { allowOpenExternalUrl: false };
    const onEventFunctions = [];
    const onUpdateFunctions = [];
    const onStartFunctions = [];
    const batchEvents = {
        events: [],
    };
    const bootstrapData = await EnvironmentApi.getBootstrapData({});
    const fullData = JSON.parse(bootstrapData.entity?.metadataJson || "{}");
    const isPreview = await EnvironmentApi.isPreviewMode({});
    const unsafeAllowed = await EnvironmentApi.areUnsafeRequestAllowed({});
    const explorerConfiguration = await EnvironmentApi.getExplorerConfiguration({});
    if (!fullData || !fullData.main) {
        throw new Error(`No boostrap data`);
    }
    const mappingName = fullData.main;
    const mapping = bootstrapData.entity?.content.find(($) => $.file === mappingName);
    if (!mapping) {
        await EngineApi.sendBatch({ actions: [(0, Utils_1.initMessagesFinished)()] });
        throw new Error(`SDK: Error while loading scene. Main file missing.`);
    }
    const url = (0, Utils_1.resolveMapping)(mapping.hash, mappingName, bootstrapData.baseUrl);
    const codeRequest = await fetch(url);
    if (!codeRequest.ok) {
        await EngineApi.sendBatch({ actions: [(0, Utils_1.initMessagesFinished)()] });
        throw new Error(`SDK: Error while loading ${url} (${mappingName} -> ${mapping?.file}:${mapping?.hash}) the mapping was not found`);
    }
    Utils_1.componentSerializeOpt.useBinaryTransform = explorerConfiguration.configurations["enableBinaryTransform"] === "true";
    let didStart = false;
    let updateIntervalMs = 1000 / 30;
    async function sendBatchAndProcessEvents() {
        const actions = batchEvents.events;
        if (actions.length) {
            batchEvents.events = [];
        }
        const res = await EngineApi.sendBatch({ actions });
        for (const e of res.events) {
            eventReceiver((0, Events_1.EventDataToRuntimeEvent)(e));
        }
    }
    function eventReceiver(event) {
        if (event.type === "raycastResponse") {
            const idAsNumber = parseInt(event.data.queryId, 10);
            if (Utils_1.numberToIdStore[idAsNumber]) {
                event.data.queryId = Utils_1.numberToIdStore[idAsNumber].toString();
            }
        }
        if (!didStart && event.type === "sceneStart") {
            didStart = true;
            for (const startFunctionCb of onStartFunctions) {
                try {
                    startFunctionCb();
                }
                catch (e) {
                    devToolsAdapter.error(e);
                }
            }
        }
        if (isPointerEvent(event)) {
            eventState.allowOpenExternalUrl = true;
        }
        for (const cb of onEventFunctions) {
            try {
                cb(event);
            }
            catch (err) {
                devToolsAdapter.error(err);
            }
        }
        eventState.allowOpenExternalUrl = false;
    }
    let start = performance.now();
    function reschedule() {
        const ms = Math.max((updateIntervalMs - (performance.now() - start)) | 0, 0);
        setTimeout(mainLoop, ms);
    }
    function mainLoop() {
        const now = performance.now();
        const dtMillis = now - start;
        start = now;
        const dtSecs = dtMillis / 1000;
        for (const trigger of onUpdateFunctions) {
            try {
                trigger(dtSecs);
            }
            catch (e) {
                devToolsAdapter.error(e);
            }
        }
        sendBatchAndProcessEvents().catch(devToolsAdapter.error).finally(reschedule);
    }
    try {
        const sourceCode = await codeRequest.text();
        const dcl = (0, DecentralandInterface_1.createDecentralandInterface)({
            clientPort,
            onError: (err) => devToolsAdapter.error(err),
            onLog: (...args) => devToolsAdapter.log(...args),
            sceneId: bootstrapData.id,
            eventState,
            batchEvents,
            EngineApi,
            onEventFunctions,
            onStartFunctions,
            onUpdateFunctions,
        });
        // create the context for the scene
        const runtimeExecutionContext = (0, sandbox_1.prepareSandboxContext)({
            dcl,
            canUseFetch,
            canUseWebsocket,
            log: dcl.log,
            previewMode: isPreview.isPreview || unsafeAllowed.status,
        });
        if (bootstrapData.useFPSThrottling === true) {
            (0, SetupFpsThrottling_1.setupFpsThrottling)(dcl, fullData.scene.parcels.map(parseParcelPosition), (newValue) => {
                updateIntervalMs = newValue;
            });
        }
        // run the code of the scene
        await (0, sandbox_1.customEval)(sourceCode, runtimeExecutionContext);
    }
    catch (err) {
        await EngineApi.sendBatch({ actions: [(0, Utils_1.initMessagesFinished)()] });
        devToolsAdapter.error(new Error(`SceneRuntime: Error while evaluating the scene ${workerName}`));
        // The devToolsAdapter.error isn't a async function
        //  and the port can be closed because the finishing of the worker
        await sleep(100);
        throw err;
    }
    // then notify the kernel that the initial scene was loaded
    batchEvents.events.push((0, Utils_1.initMessagesFinished)());
    // wait for didStart=true
    do {
        await sendBatchAndProcessEvents();
    } while (!didStart && (await sleep(100)));
    // finally, start event loop
    mainLoop();
    // shutdown
}
exports.startSceneRuntime = startSceneRuntime;
function isPointerEvent(event) {
    switch (event.type) {
        case "uuidEvent":
            return event.data?.payload?.buttonId !== undefined;
    }
    return false;
}
async function sleep(ms) {
    await new Promise((resolve) => setTimeout(resolve, Math.max(ms | 0, 0)));
    return true;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2NlbmVSdW50aW1lLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3dvcmtlci9TY2VuZVJ1bnRpbWUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEscUNBQXVDO0FBQ3ZDLG1DQUFzRztBQUN0Ryx1Q0FBNkQ7QUFFN0QsbUdBQThGO0FBRTlGLDJFQUEyRztBQUMzRyxxRUFBaUU7QUFFakUsK0RBQTJEO0FBQzNELDZDQUFzSDtBQUd0SDs7R0FFRztBQUNILFNBQVMsbUJBQW1CLENBQUMsUUFBZ0I7SUFDM0MsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxRQUFRO1NBQ3BCLElBQUksRUFBRTtTQUNOLEtBQUssQ0FBQyxTQUFTLENBQUM7U0FDaEIsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUE7SUFDOUIsT0FBTyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQTtBQUNqQixDQUFDO0FBRU0sS0FBSyxVQUFVLGlCQUFpQixDQUFDLE1BQWlCO0lBQ3ZELE1BQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUE7SUFDNUIsTUFBTSxVQUFVLEdBQUcsTUFBTSxNQUFNLENBQUMsVUFBVSxDQUFDLFNBQVMsVUFBVSxFQUFFLENBQUMsQ0FBQTtJQUVqRSxNQUFNLENBQUMsU0FBUyxFQUFFLGNBQWMsRUFBRSxXQUFXLEVBQUUsUUFBUSxDQUFDLEdBQUcsTUFBTSxPQUFPLENBQUMsR0FBRyxDQUFDO1FBQzNFLHFCQUFZLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBQztRQUNsQyxxQkFBWSxDQUFDLGNBQWMsQ0FBQyxVQUFVLENBQUM7UUFDdkMscUJBQVksQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDO1FBQ3BDLHFCQUFZLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQztLQUNsQyxDQUFDLENBQUE7SUFFRixNQUFNLENBQUMs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
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.DevToolsAdapter = void 0;
class DevToolsAdapter {
    constructor(devTools) {
        this.devTools = devTools;
        this.exceptions = [];
        this.catchHandler = (...args) => console.log(...args);
    }
    log(...args) {
        const params = {
            type: 'log',
            timestamp: performance.now(),
            executionContextId: 0,
            args: args.map(($) => {
                let value = undefined;
                let unserializableValue = undefined;
                const type = typeof $;
                if (type === 'object' && $ !== null) {
                    try {
                        JSON.stringify($);
                        value = $;
                    }
                    catch (error) {
                        unserializableValue = Object.prototype.toString.apply($);
                    }
                }
                else if (type === 'number' && (isNaN($) || !isFinite($))) {
                    unserializableValue = Object.prototype.toString.apply($);
                }
                else {
                    value = $;
                }
                const remoteObject = {
                    type: typeof $,
                    value,
                    unserializableValue
                };
                return remoteObject;
            })
        };
        this.devTools.event({
            type: 'Runtime.consoleAPICalled',
            jsonPayload: JSON.stringify([params])
        }).catch(this.catchHandler);
    }
    error(e) {
        const exceptionId = this.exceptions.push(e) - 1;
        let value = undefined;
        let unserializableValue = undefined;
        try {
            value = JSON.stringify(e);
            if (value === '{}' && e instanceof Error) {
                // most Error objects serialize to empty objects
                value = JSON.stringify({
                    message: e.message,
                    name: e.name,
                    stack: e.stack
                });
            }
        }
        catch (error) {
            unserializableValue = e.toString();
        }
        const exception = {
            type: typeof e,
            value,
            unserializableValue
        };
        const param = {
            timestamp: performance.now(),
            exceptionDetails: {
                text: e.toString() + '\n' + e.stack,
                exceptionId,
                columnNumber: 0,
                lineNumber: 0,
                exception
            }
        };
        this.devTools.event({
            type: 'Runtime.exceptionThrown',
            jsonPayload: JSON.stringify([param])
        }).catch(this.catchHandler);
    }
}
exports.DevToolsAdapter = DevToolsAdapter;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRGV2VG9vbHNBZGFwdGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL3dvcmtlci9ydW50aW1lL0RldlRvb2xzQWRhcHRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFHQSxNQUFhLGVBQWU7SUFHMUIsWUFBbUIsUUFBbUM7UUFBbkMsYUFBUSxHQUFSLFFBQVEsQ0FBMkI7UUFGdEQsZUFBVSxHQUFZLEVBQUUsQ0FBQTtRQStFaEIsaUJBQVksR0FBRyxDQUFDLEdBQUcsSUFBVyxFQUFFLEVBQUUsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUE7SUE3RUwsQ0FBQztJQUUzRCxHQUFHLENBQUMsR0FBRyxJQUFXO1FBQ2hCLE1BQU0sTUFBTSxHQUEyQztZQUNyRCxJQUFJLEVBQUUsS0FBSztZQUNYLFNBQVMsRUFBRSxXQUFXLENBQUMsR0FBRyxFQUFFO1lBQzVCLGtCQUFrQixFQUFFLENBQUM7WUFDckIsSUFBSSxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRTtnQkFDbkIsSUFBSSxLQUFLLEdBQUcsU0FBUyxDQUFBO2dCQUNyQixJQUFJLG1CQUFtQixHQUFHLFNBQVMsQ0FBQTtnQkFDbkMsTUFBTSxJQUFJLEdBQUcsT0FBTyxDQUFDLENBQUE7Z0JBQ3JCLElBQUksSUFBSSxLQUFLLFFBQVEsSUFBSSxDQUFDLEtBQUssSUFBSSxFQUFFO29CQUNuQyxJQUFJO3dCQUNGLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUE7d0JBQ2pCLEtBQUssR0FBRyxDQUFDLENBQUE7cUJBQ1Y7b0JBQUMsT0FBTyxLQUFLLEVBQUU7d0JBQ2QsbUJBQW1CLEdBQUcsTUFBTSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFBO3FCQUN6RDtpQkFDRjtxQkFBTSxJQUFJLElBQUksS0FBSyxRQUFRLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRTtvQkFDMUQsbUJBQW1CLEdBQUcsTUFBTSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFBO2lCQUN6RDtxQkFBTTtvQkFDTCxLQUFLLEdBQUcsQ0FBQyxDQUFBO2lCQUNWO2dCQUNELE1BQU0sWUFBWSxHQUFrQztvQkFDbEQsSUFBSSxFQUFFLE9BQU8sQ0FBQztvQkFDZCxLQUFLO29CQUNMLG1CQUFtQjtpQkFDcEIsQ0FBQTtnQkFDRCxPQUFPLFlBQVksQ0FBQTtZQUNyQixDQUFDLENBQUM7U0FDSCxDQUFBO1FBRUQsSUFBSSxDQUFDLFFBQVMsQ0FBQyxLQUFLLENBQUM7WUFDbkIsSUFBSSxFQUFFLDBCQUEwQjtZQUNoQyxXQUFXLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1NBQ3RDLENBQUMsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFBO0lBQzdCLENBQUM7SUFFRCxLQUFLLENBQUMsQ0FBUTtRQUNaLE1BQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQTtRQUMvQyxJQUFJLEtBQUssR0FBa0IsU0FBUyxDQUFBO1FBQ3BDLElBQUksbUJBQW1CLEdBQUcsU0FBUyxDQUFBO1FBQ25DLElBQUk7WUFDRixLQUFLLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQTtZQUN6QixJQUFJLEtBQUssS0FBSyxJQUFJLElBQUksQ0FBQyxZQUFZLEtBQUssRUFBRTtnQkFDeEMsZ0RBQWdEO2dCQUNoRCxLQUFLLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQztvQkFDckIsT0FBTyxFQUFFLENBQUMsQ0FBQyxPQUFPO29CQUNsQixJQUFJLEVBQUUsQ0FBQyxDQUFDLElBQUk7b0JBQ1osS0FBSyxFQUFFLENBQUMsQ0FBQyxLQUFLO2lCQUNmLENBQUMsQ0FBQTthQUNIO1NBQ0Y7UUFBQyxPQUFPLEtBQUssRUFBRTtZQUNkLG1CQUFtQixHQUFHLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQTtTQUNuQztRQUNELE1BQU0sU0FBUyxHQUFrQztZQUMvQyxJQUFJLEVBQUUsT0FBTyxDQUFDO1lBQ2QsS0FBSztZQUNMLG1CQUFtQjtTQUNwQixDQUFBO1FBQ0QsTUFBTSxLQUFLLEdBQTBDO1lBQ25ELFNBQVMsRUFBRSxXQUFXLENBQUMsR0FBRyxFQUFFO1lBQzVCLGdCQUFnQixFQUFFO2dCQUNoQixJQUFJLEVBQUUsQ0FBQyxDQUFDLFFBQVEsRUFBRSxHQUFHLElBQUksR0FBRyxDQUFDLENBQUMsS0FBSztnQkFDbkMsV0FBVztnQkFDWCxZQUFZLEVBQUUsQ0FBQztnQkFDZixVQUFVLEVBQUUsQ0FBQztnQkFDYixTQUFTO2FBQ1Y7U0FDRixDQUFBO1FBRUQsSUFBSSxDQUFDLFFBQVMsQ0FBQyxLQUFLLENBQUM7WUFDbkIsSUFBSSxFQUFFLHlCQUF5QjtZQUMvQixXQUFXLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQ3JDLENBQUMsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFBO0lBQzdCLENBQUM7Q0FHRjtBQWpGRCwwQ0FpRkMifQ==
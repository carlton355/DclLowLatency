"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createDecentralandInterface = void 0;
const client_1 = require("../client");
const Utils_1 = require("../Utils");
const engine_api_gen_1 = require("@dcl/protocol/out-ts/decentraland/kernel/apis/engine_api.gen");
function createDecentralandInterface(options) {
    const { batchEvents, onError, onLog, sceneId, onEventFunctions, clientPort, eventState } = options;
    const sceneLoadedModules = {};
    const dcl = {
        DEBUG: true,
        log(...args) {
            onLog(...args);
        },
        openExternalUrl(url) {
            try {
                const u = new URL(url);
                if (u.protocol !== 'https:')
                    throw new Error('Only https: external links are allowed');
            }
            catch (err) {
                onError(err);
                return;
            }
            if (JSON.stringify(url).length > 49000) {
                onError(new Error('URL payload cannot exceed 49.000 bytes'));
                return;
            }
            if (eventState.allowOpenExternalUrl) {
                batchEvents.events.push({
                    type: engine_api_gen_1.EAType.EAT_OPEN_EXTERNAL_URL,
                    tag: '',
                    payload: { openExternalUrl: { url } }
                });
            }
            else {
                this.error('openExternalUrl can only be used inside a pointerEvent');
            }
        },
        openNFTDialog(assetContractAddress, tokenId, comment) {
            if (eventState.allowOpenExternalUrl) {
                const payloadLength = assetContractAddress.length + tokenId.length + (comment?.length || 0);
                if (payloadLength > 49000) {
                    onError(new Error('OpenNFT payload cannot exceed 49.000 bytes'));
                    return;
                }
                batchEvents.events.push({
                    type: engine_api_gen_1.EAType.EAT_OPEN_NFT_DIALOG,
                    tag: '',
                    payload: { openNftDialog: { assetContractAddress, tokenId, comment: comment || '' } }
                });
            }
            else {
                this.error('openNFTDialog can only be used inside a pointerEvent');
            }
        },
        addEntity(entityId) {
            if (entityId === '0') {
                // We dont create the entity 0 in the engine.
                return;
            }
            batchEvents.events.push({
                type: engine_api_gen_1.EAType.EAT_CREATE_ENTITY,
                payload: { createEntity: { id: entityId } }
            });
        },
        removeEntity(entityId) {
            batchEvents.events.push({
                type: engine_api_gen_1.EAType.EAT_REMOVE_ENTITY,
                payload: { removeEntity: { id: entityId } }
            });
        },
        /** update tick */
        onUpdate(cb) {
            if (typeof cb !== 'function') {
                onError(new Error('onUpdate must be called with only a function argument'));
            }
            else {
                options.onUpdateFunctions.push(cb);
            }
        },
        /** event from the engine */
        onEvent(cb) {
            if (typeof cb !== 'function') {
                onError(new Error('onEvent must be called with only a function argument'));
            }
            else {
                onEventFunctions.push(cb);
            }
        },
        /** called after adding a component to the entity or after updating a component */
        updateEntityComponent(entityId, componentName, classId, json) {
            if (json.length > 49000) {
                onError(new Error('Component payload cannot exceed 49.000 bytes'));
                return;
            }
            if (Utils_1.componentNameRE.test(componentName)) {
                batchEvents.events.push({
                    type: engine_api_gen_1.EAType.EAT_UPDATE_ENTITY_COMPONENT,
                    tag: sceneId + '_' + entityId + '_' + classId,
                    payload: {
                        updateEntityComponent: {
                            entityId,
                            classId,
                            name: componentName.replace(Utils_1.componentNameRE, ''),
                            json: (0, Utils_1.generatePBObject)(classId, json)
                        }
                    }
                });
            }
        },
        /** called after adding a DisposableComponent to the entity */
        attachEntityComponent(entityId, componentName, id) {
            if (Utils_1.componentNameRE.test(componentName)) {
                batchEvents.events.push({
                    type: engine_api_gen_1.EAType.EAT_ATTACH_ENTITY_COMPONENT,
                    tag: entityId,
                    payload: {
                        attachEntityComponent: {
                            entityId,
                            name: componentName.replace(Utils_1.componentNameRE, ''),
                            id
                        }
                    }
                });
            }
        },
        /** call after removing a component from the entity */
        removeEntityComponent(entityId, componentName) {
            if (Utils_1.componentNameRE.test(componentName)) {
                batchEvents.events.push({
                    type: engine_api_gen_1.EAType.EAT_COMPONENT_REMOVED,
                    tag: entityId,
                    payload: {
                        componentRemoved: {
                            entityId,
                            name: componentName.replace(Utils_1.componentNameRE, '')
                        }
                    }
                });
            }
        },
        /** set a new parent for the entity */
        setParent(entityId, parentId) {
            batchEvents.events.push({
                type: engine_api_gen_1.EAType.EAT_SET_ENTITY_PARENT,
                tag: entityId,
                payload: {
                    setEntityParent: {
                        entityId,
                        parentId
                    }
                }
            });
        },
        /** queries for a specific system with a certain query configuration */
        query(queryType, payload) {
            payload.queryId = (0, Utils_1.getIdAsNumber)(payload.queryId).toString();
            batchEvents.events.push({
                type: engine_api_gen_1.EAType.EAT_QUERY,
                tag: sceneId + '_' + payload.queryId,
                payload: {
                    query: {
                        queryId: (0, engine_api_gen_1.queryTypeFromJSON)(queryType),
                        payload: JSON.stringify(payload)
                    }
                }
            });
        },
        /** subscribe to specific events, events will be handled by the onEvent function */
        subscribe(eventName) {
            options.EngineApi.subscribe({ eventId: eventName }).catch((err) => onError(err));
        },
        /** unsubscribe to specific event */
        unsubscribe(eventName) {
            options.EngineApi.unsubscribe({ eventId: eventName }).catch((err) => onError(err));
        },
        componentCreated(id, componentName, classId) {
            if (Utils_1.componentNameRE.test(componentName)) {
                batchEvents.events.push({
                    type: engine_api_gen_1.EAType.EAT_COMPONENT_CREATED,
                    tag: id,
                    payload: {
                        componentCreated: {
                            id,
                            classId,
                            name: componentName.replace(Utils_1.componentNameRE, '')
                        }
                    }
                });
            }
        },
        componentDisposed(id) {
            batchEvents.events.push({
                type: engine_api_gen_1.EAType.EAT_COMPONENT_DISPOSED,
                tag: id,
                payload: {
                    componentDisposed: { id }
                }
            });
        },
        componentUpdated(id, json) {
            batchEvents.events.push({
                type: engine_api_gen_1.EAType.EAT_COMPONENT_UPDATED,
                tag: id,
                payload: {
                    componentUpdated: {
                        id,
                        json
                    }
                }
            });
        },
        loadModule: async (_moduleName) => {
            if (!(_moduleName in sceneLoadedModules)) {
                const loadedModule = loadSceneModule(clientPort, _moduleName);
                sceneLoadedModules[_moduleName] = {
                    rpcHandle: _moduleName,
                    __INTERNAL_UNSAFE_loadedModule: loadedModule,
                    methods: Object.keys(loadedModule).map((name) => ({ name }))
                };
            }
            return sceneLoadedModules[_moduleName];
        },
        callRpc: async (rpcHandle, methodName, args) => {
            const module = sceneLoadedModules[rpcHandle];
            if (!module) {
                throw new Error(`RPCHandle: ${rpcHandle} is not loaded`);
            }
            // eslint-disable-next-line prefer-spread
            return module.__INTERNAL_UNSAFE_loadedModule[methodName].apply(module, args);
        },
        onStart(cb) {
            options.onStartFunctions.push(cb);
        },
        error(message, data) {
            onError(Object.assign(new Error(message), { data }));
        }
    };
    return dcl;
}
exports.createDecentralandInterface = createDecentralandInterface;
function loadSceneModule(clientPort, moduleName) {
    // - moduleNames that start with @decentraland are from ECS6 and they should load the legacy ones.
    // - moduleNames that start with ~system, are the new ones that follow the protocol buffer generation
    //    (a single object as @param, and a single object as @returns)
    const moduleToLoad = moduleName.replace(/^@decentraland\//, 'Legacy').replace(/^~system\//, '');
    try {
        if (moduleToLoad in client_1.LoadableApis) {
            return client_1.LoadableApis[moduleToLoad](clientPort);
        }
        else {
            throw new Error('The module is not available in the list!');
        }
    }
    catch (e) {
        throw Object.assign(new Error(`Error getting the methods of ${moduleToLoad}: ` + e.message), {
            original: e
        });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRGVjZW50cmFsYW5kSW50ZXJmYWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL3dvcmtlci9ydW50aW1lL0RlY2VudHJhbGFuZEludGVyZmFjZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSxzQ0FBd0M7QUFDeEMsb0NBQTJFO0FBRzNFLGlHQUtxRTtBQW9CckUsU0FBZ0IsMkJBQTJCLENBQUMsT0FBcUM7SUFDL0UsTUFBTSxFQUFFLFdBQVcsRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxVQUFVLEVBQUUsVUFBVSxFQUFFLEdBQUcsT0FBTyxDQUFBO0lBRWxHLE1BQU0sa0JBQWtCLEdBQXNDLEVBQUUsQ0FBQTtJQUVoRSxNQUFNLEdBQUcsR0FBMEI7UUFDakMsS0FBSyxFQUFFLElBQUk7UUFDWCxHQUFHLENBQUMsR0FBRyxJQUFXO1lBQ2hCLEtBQUssQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFBO1FBQ2hCLENBQUM7UUFFRCxlQUFlLENBQUMsR0FBVztZQUN6QixJQUFJO2dCQUNGLE1BQU0sQ0FBQyxHQUFHLElBQUksR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFBO2dCQUN0QixJQUFJLENBQUMsQ0FBQyxRQUFRLEtBQUssUUFBUTtvQkFBRSxNQUFNLElBQUksS0FBSyxDQUFDLHdDQUF3QyxDQUFDLENBQUE7YUFDdkY7WUFBQyxPQUFPLEdBQVEsRUFBRTtnQkFDakIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFBO2dCQUNaLE9BQU07YUFDUDtZQUVELElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNLEdBQUcsS0FBSyxFQUFFO2dCQUN0QyxPQUFPLENBQUMsSUFBSSxLQUFLLENBQUMsd0NBQXdDLENBQUMsQ0FBQyxDQUFBO2dCQUM1RCxPQUFNO2FBQ1A7WUFFRCxJQUFJLFVBQVUsQ0FBQyxvQkFBb0IsRUFBRTtnQkFDbkMsV0FBVyxDQUFDLE1B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
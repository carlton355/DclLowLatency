"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const lib_1 = require("../lib");
const http = require("http");
const server = http.createServer(lib_1.serveRaw(`
    <script>
      describe('a', function(){
        it('does something', function(){
          console.log('Hello!!!!1')
        })
      })

      mocha.run()
    </script>
  `));
const serverFailure = http.createServer(lib_1.serveRaw(`
    <script>
      describe('testing failures', function(){
        it('this should fail', function(){
          throw new Error('If you see this error message, the test should pass')
        })
      })
      mocha.run()
    </script>
  `));
async function doTest() {
    console.log('Testing passing fixture');
    const passingResult = await lib_1.run({
        file: 'http://localhost:7667',
        args: ['--no-sandbox', '--disable-setuid-sandbox']
    });
    console.dir(passingResult);
    console.assert(passingResult.result.passed, 'It should pass');
    const failingResult = await lib_1.run({
        file: 'http://localhost:7666',
        args: ['--no-sandbox', '--disable-setuid-sandbox']
    });
    console.assert(!failingResult.result.passed, 'It should fail');
}
server.listen(7667, function () {
    serverFailure.listen(7666, function () {
        doTest()
            .then(() => process.exit(0))
            .catch(err => {
            console.error(err);
            process.exit(1);
        });
    });
});
//# sourceMappingURL=test.js.map